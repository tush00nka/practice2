#import "template.typ": template
#import "title.typ": title-page

#let over(a, b) = $#h(0pt)^(#scale(a, 140%)) #h(-1pt) slash #h(-2.5pt)_(#scale(b, 140%))$

#title-page(
  course: "статистическая обработка информации",
  department: 41,
  group: 4318,
  number: 2,
  student-name: "А.Д. Борисоглебский",
  teacher-name: "Г.В. Титова",
  teacher-position: "канд. техн. наук, доцент",
  title: "Статистическая проверка критериев"
)

#show: template

#outline()

#heading(numbering: none, outlined: true)[ВВЕДЕНИЕ]

*Цель работы:* провести статистическую проверку критериев.

Данные взяты с сайта статистики Испании, из раздела демографии.
Данные содержат информацию о рождениях, естественному приросту населения
и случаях внутриутробной смерти в абсолютный величинах (кол-во случаев).

Ссылка: https://www.ine.es/jaxiT3/Datos.htm?t=6567#_tabs-tabla

Также для проведения более полного исследования были взяты данные 
о случаях домашнего насилия в регионах, также в абсолютных величинах.

Ссылка: https://www.ine.es/dynInfo/Infografia/Territoriales/capitulo.html#!tabla

Данные по рождаемости относятся к 2023 году. Данные по насилию к 2024-му.
Однако разница не будет ощутима, так как глобальные изменения в поведении
населения не возникают за такие короткие промежутки времени.

= Описание данных

Данные взяты по 19-ти регионам Испании. 

Из основного источника взяты признаки: рождаемость, естественный прирост,
случаи смерти плода. Из дополнительных данных взята статистика по жертвам насилия, домашнего и в общем.

Итоговые датафреймы представлены на @df[рисунках]--@violencia[].

#figure(
	caption: [Датафрейм с данными о рождаемости],
	image("images/table.png")
) <df>

#figure(
	caption: [Датафрейм с данными о жертвах насилия],
	image("images/violencia.png")
) <violencia>

= Наглядное представление

Распределение данных о рождении детей и естественном приросте по 
регионам представлено на @dist1[рисунке].

#figure(
	caption: [График распределения признаков],
	image("images/dist1.png")
) <dist1>

Распределение данных о случаях смерти по 
регионам представлено на @dist2[рисунке].

#figure(
	caption: [График распределения признаков],
	image("images/dist2.png")
) <dist2>

Распределение данных о случаях домашнего и общего насилия по 
регионам представлено на @dist3[рисунке].

#figure(
	caption: [График распределения признаков по насилию],
	image("images/dist3.png")
) <dist3>

= Критерий Шапиро-Уилка

*Для чего используется:*

Критерий проверяет, является ли распределение данных нормальным.
Если доказана нормальноть, то можно использовать  
параметричечские методы (корреляция Пирсона), а если нет --- нужно 
использовать непараметрические (Спирмен, Манн-Уитни). По 
результатам этого теста решается, какие критерии применять в дальнейшем
исследовании.

*Условия применения:*
- 3 $<=$ n $<=$ 50 (при большем количестве снижается точность)
- Проверка нормальности

*Для признаков:*
Рождения, естественный прирост, случаи смерти.

*Нулевая гипотеза:*

$H_0 = {f(x) = N(a, sigma^2)}$

Данные распределены нормально

*Альтернативная гипотеза:* 

$H_1 = {f(x) eq.not N(a, sigma^2)}$

Данные не распределены нормально

*Формула:*

$ W = (sum_(i=1)^n a_i x_((i)))^2 / (sum_(i=1)^n (x_i - overline(x))^2) $

где:
- $x_((i))$ --- упорядоченные значения выборки
- $a_i$ --- коэффициенты, рассчитываемые на основе ожидаемых значений порядковых статистик нормального распределения
- $overline(x)$ --- среднее значение выборки
- $n$ --- объём выборки

*Команда в Python:*
```python
from scipy.stats import shapiro
stat, p = shapiro(x)
```

Тест Шапиро-Уилка показал, что данные не распределены нормально
(табл. 1).

#figure(
  table(
    columns: (auto, auto, auto, auto, auto),
    align: (left, center, center, center, left),
    stroke: 0.5pt,
    [*Признак*], [*W*], [*p-value*], [*Сравнение*], [*Вывод*],
    [Рождения], [0.7446], [0.0002], [p ≤ 0.05], [Отвергаем $H_0$, значит данные НЕ нормальны],
    [Естественный прирост], [0.9234], [0.1306], [p $>=$ 0.05], [Не может отвергнуть $H_0$, однако выборка из 18 значений и статистика $0.92$ свидетельствует о недостаточной нормальности распределения],
    [Сметри плода], [0.7983], [0.0011], [p ≤ 0.05], [Отвергаем $H_0$, значит данные НЕ нормальны],
    [Случаи домашнего насилия], [0.8029], [0.0013], [p ≤ 0.05], [Отвергаем $H_0$, значит данные НЕ нормальны]
  ),
  caption: [Результаты критерия Шапиро-Уилка]
)

В результате все данные не подчиняются нормальному закону распределения
(в полной мере).
Для дальнейшего исследования используем непараметрические критерии.

= Критерий корреляции Спирмена

*Для чего используется:*

Критерий показывает, есть ли связь между двумя признаками. Если один 
признак растёт, растёт ли вместе с ним другой (положительная связь), или 
наоборот --- один растёт, а другой падает (отрицательная связь).

Используем для проверки связи между домашним 
насилием и случаями смерти детей.

*Условия применения:*
- n $>=$ 5
- Непараметрический
- Не требует нормальности

*Для признаков:*

Домашнее насилие и случаи смерти детей. Попытаемся определить, есть ли
зависимость.

*Нулевая гипотеза:*

$H_0 = {rho_s = 0}$

Корреляция отсутствует

*Альтернативная гипотеза:* 

$H_1 = {rho_s > 0}$ --- положительная корреляция

$H_2 = {rho_s < 0}$ --- отрицательная корреляция

$H_3 = {rho_s eq.not 0}$ --- корреляция существует (выборано через alternative='two-sided')

Корреляция существует

*Формула:*

Коэффициент корреляции Спирмена:

$ rho_s = 1 - (6 sum_(i=1)^n d_i^2) / (n(n^2 - 1)) $

где:
- $d_i$ --- разность между рангами соответствующих значений X и Y
- $n$ --- объём выборки
- $rho_s in [-1, 1]$ (от -1 до 1)

*Команда в Python:*

```python
from scipy.stats import spearmanr
corr, p = spearmanr(violencia_domestica, deaths)
```

*Паргументы по умолчанию:*
- `axis=0` --- вычисление корреляции по столбцам
- `nan_policy='propagate'` --- обработка пропущенных значений (NaN тоже учитывает)
- `alternative='two-sided'` --- двусторонняя альтернатива ($rho eq.not 0$)

*Результат:* p-value ≤ 0.05

*Вывод:* Отвергаем $H_0$. Существует высокая коррелция ($rho = 0.8516$).

*Интерпретация:* Положительная корреляция. Данные изменяются
вместе, однако нельзя утверждать о наличии причинно-следственной связи.
Вероятнее всего есть общий показатель, влияющий на исследуемые значения
(например, численность населения регионов).

= Критерий корреляции Кендалла

*Для чего используется:*

Критерий Кендалла проверяет связь между двумя признаками. Основное 
отличие --- Кендалл более устойчив к выбросам и лучше подходит для 
небольших выборок. Используется как дополнительная проверка корреляции. 
В работе применяется для анализа связи между 

*Условия применения:*
- n $>=$ 5
- Устойчив к выбросам
- Не требует нормальности

*Для признаков:*

Домашнее насилие и случаи смерти детей. Берём те же данные,
чтобы проверить ту же гипотезу другим способом.

*Нулевая гипотеза:*

$H_0 = {tau = 0}$

Корреляция отсутствует

*Альтернативная гипотеза:* 

$H_1 = {tau eq.not 0}$

Корреляция существует

*Формула:*

Коэффициент корреляции Кендалла:

$ tau = (C - D) / (n(n-1)/2) $

где:
- $C$ --- количество согласованных (конкордантных) пар
- $D$ --- количество несогласованных (дискордантных) пар
- $n$ --- объём выборки
- $tau in [-1, 1]$ (от -1 до 1)

*Команда в Python:*
```python
from scipy.stats import kendalltau
corr, p = kendalltau(a, b)
```

*Аргументы по умолчанию:*
- `method='auto'` --- автоматический выбор метода вычисления (может быть asymptotic для больших выборок либо exact для точности и маленьких выборок)
- `variant='b'` --- вариант статистики τ Кендалла ("b" - для пар наблюдений, а "c" - для прямоугольных таблиц сопряженности)
- `alternative='two-sided'` --- двусторонняя альтернатива
- `nan_policy='propagate'` --- обработка пропущенных значений

*Результат:* 
p-value ≤ 0.05

*Вывод:* Отвергаем $H_0$. Корреляция существует ($tau=0.6647$)

*Интерпретация:* Положительная связь --- данные изменияются согласованно.
Двумя способами получен одинаковый вывод.

= Критерий Манна-Уитни

*Для чего используется:*

Критерий сравнивает две группы и проверяет, различаются ли они 
статистически. В работе используется для сравнения естественного 
прироста в регионах --- проверяем, действительно ли две группы 
отличаются друг от друга.

*Условия применения:*
- 2 независимые группы
- n₁, n₂ $>=$ 3
- Не требует нормальности

*Для признаков:*

Естественный прирост (2 группы, $n_1=9, n_2=10$). 

Выборка разделена на две группы по медиане:
- Группа 1: регионы с рождаемостью < 8738
- Группа 2: регионы с рождаемостью $>=$ 8738

*Нулевая гипотеза:*

$H_0 = {F_(X_1)(x) = F_(X_2)(x)}$

Распределения идентичны (две независимые выборки принадлежат однородным генеральным совокупностям)

*Альтернативная гипотеза:* 

$H_1 = {F_(X_1)(x) eq.not F_(X_2)(x)}$

Распределения различаются

*Формула:*

U-статистика Манна-Уитни:

$ U = n_1 n_2 + (n_1(n_1+1))/2 - R_1 $

где:
- $n_1, n_2$ --- объёмы первой и второй выборок
- $R_1$ --- сумма рангов элементов первой выборки в общей упорядоченной 
	выборке
- Вычисляется также $U' = n_1 n_2 - U$, используется $min(U, U')$

*Команда в Python:*
```python
from scipy.stats import mannwhitneyu
stat, p = mannwhitneyu(low,high, alternative='two-sided')
```

*Аргументы по умолчанию:*
- `use_continuity=True` --- применение поправки на непрерывность (True рекомендуется для малых выборок)
- `alternative='two-sided'` --- двусторонняя альтернатива
- `method='auto'` --- автоматический выбор метода вычисления
- `nan_policy='propagate'` --- обработка пропущенных значений
- `keepdims=False` --- не сохранять размерность массива (False - скалярный результат, True - массив)

*Результат:*

U = 73.0, p = 0.0247

p-value ≤ 0.05 --- отвергаем $H_0$

*Вывод:* Регионы с высокой рождаемостью ($>=$8738) имеют статистически 
значимо отличающийся естественный прирост по сравнению с регионами с 
низкой рождаемостью.

= Медианный критерий

*Для чего используется:*

Критерий сравнивает медианы двух или более групп. Работает проще, чем 
Манн-Уитни --- делит все данные на две категории (выше и ниже общей 
медианы) и сравнивает пропорции. Более устойчив к сильным выбросам. 
Используется как проверка различий между группами регионов по смертности.

*Условия применения:*
- 2+ группы
- Устойчив к выбросам
- Не требует нормальности

*Для признаков:*

Смертность (2 группы, $n_1=9, n_2=10$). 

Выборка разделена на две группы по медиане:
- Группа 1: регионы с рождаемостью < 8738
- Группа 2: регионы с рождаемостью $>=$ 8738

*Нулевая гипотеза:*

$H_0 = {med_(X_1) = med_(X_2) = ... = med_(X_n)}$

Медианы всех выборок равны (несколько независимых выборок принадлежат однородным генеральным совокупностям)

*Альтернативная гипотеза:* 

$H_1 = {#text("хотя бы одно равенство не выполняется")}$

Хотя бы одна медиана отличается от других

*Формула:*

Медианный критерий использует статистику хи-квадрат:

$ chi^2 = sum_(i=1)^k sum_(j=1)^2 (O_(i j) - E_(i j))^2 / E_(i j) $

где:
- $O_(i j)$ --- наблюдаемые частоты (количество значений выше/ниже общей медианы в каждой группе)
- $E_(i j)$ --- ожидаемые частоты при условии равенства медиан
- $k$ --- количество групп

*Команда в Python:*
```python
from scipy.stats import median_test
stat, p, med, contingency = median_test(low, high)
```

*Аргументы по умолчанию:*
- `ties='below'` --- обработка значений, равных медиане (below - считать их ниже медианы)
- `correction=True` --- применение поправки Йейтса (True - улучшает точность на малых выборках)
- `lambda_=1` --- параметр для вычисления статистики (1 - стандартная статистика Пирсона $X^2$)
- `nan_policy='propagate'` --- обработка пропущенных значений

*Результат:*

$chi^2$ = 6.4653

p-value = 0.0110

*Вывод:*
Существует статистически значимая связь между уровнем рождаемости и 
уровнем смертности. Регионы с низкой и высокой рождаемостью по-разному 
распределяются относительно медианного уровня смертности.

*Интерпретация:*

Группа с низкой рождаемостью (< 8738):
- 1 регион имеет смертность выше медианы;
- 8 регионов имеют смертность ниже медианы;
- 89% регионов с низкой рождаемостью имеют низкую смертность.

Группа с высокой рождаемостью (≥ 8738):
- 8 регионов имеют смертность выше медианы;
- 2 региона имеют смертность ниже медианы;
- 80% регионов с высокой рождаемостью имеют высокую смертность.

== Критерий Краскела-Уоллиса

*Для чего используется:*

Критерий сравнивает три или больше групп одновременно. Проверяет, 
различаются ли группы по уровню признака. В работе используется для 
проверки того, отличаются ли регионы с разным уровнем домашнего
насилия (низкий, ниже среднего, выше среднего, высокий) по рождаемости.

*Условия применения:*
- 3+ группы
- Не требует нормальности

*Для признаков:*

Рождаемость (4 группы).
Разделение уровня насилия по квантилям.

*Нулевая гипотеза:*

$H_0 = {F_(X_1)(x) = F_(X_2)(x) = ... = F_(X_k)(x)}$

Все выборки принадлежат однородным генеральным совокупностям (медианы равны)

*Альтернативная гипотеза:* 

$H_1 = {#text("хотя бы одно равенство не выполняется")}$

Хотя бы одна медиана отличается

*Формула:*

H-статистика Краскела-Уоллиса:

$ H = (12)/(n(n+1)) sum_(i=1)^k (R_i^2)/(n_i) - 3(n+1) $

где:
- $k$ --- количество групп
- $n$ --- общий объём выборки ($n = sum_(i=1)^k n_i$)
- $n_i$ --- объём $i$-й группы
- $R_i$ --- сумма рангов $i$-й группы в общей упорядоченной выборке

*Команда в Python:*
```python
from scipy.stats import kruskal
stat, p = kruskal(low, lower, higher, high)
```

*Аргументы по умолчанию:*
- `nan_policy='propagate'` --- обработка пропущенных значений

*Результат:*

Статистика H: 11.8121

p-value: 0.0081 ≤ 0.05

*Вывод:* Отвергаем $H_0$, хотя бы одна медиана отличается от других

*Интерпретация:*
Существует статистически значимая связь между уровнем домашнего насилия 
и рождаемостью в регионах. Регионы с разной интенсивностью домашнего 
насилия систематически различаются по показателям рождаемости.

= Вывод

В ходе выполнения лабораторной работы была проведена статистическая 
обработка демографических данных 19 регионов Испании с применением шести 
непараметрических критериев, что обусловлено отсутствием нормального 
распределения данных, подтвержденным критерием Шапиро-Уилка. Все 
исследуемые показатели (рождаемость, естественный прирост, смертность 
плода, случаи домашнего насилия) показали значимые отклонения от 
нормальности (p $<=$ 0.05), за исключением естественного прироста, где 
формальное сохранение нулевой гипотезы при малом объеме выборки и 
значении статистики W = 0.9234 не позволяет считать распределение 
достаточно нормальным.

Критерий корреляции Спирмена выявил сильную положительную связь
($rho$ = 0.8516; p < 0.001) между случаями домашнего насилия и 
смертностью плода, что свидетельствует о согласованном изменении этих 
показателей, хотя причинно-следственная связь требует дополнительного 
изучения.

Критерий корреляции Кендалла, более устойчивый к выбросам, подтвердил 
наличие значимой положительной связи ($tau$ = 0.6647; p < 0.05) между 
теми же переменными, усиливая надежность выявленной закономерности.

Критерий Манна-Уитни показал статистически значимые различия в 
естественном приросте между регионами с низкой и высокой рождаемостью
(U = 73.0; p = 0.0247), что демонстрирует взаимосвязь между уровнем 
рождаемости и демографической динамикой регионов.

Медианный критерий выявил значимую связь между рождаемостью и 
смертностью ($chi^2$ = 6.4653; p = 0.011). Анализ таблицы сопряженности 
показал, что 89% регионов с низкой рождаемостью имеют низкую смертность, 
тогда как 80% регионов с высокой рождаемостью характеризуются высокой 
смертностью, что указывает на системные демографические различия.

Критерий Краскела-Уоллиса подтвердил существование статистически 
значимых различий в рождаемости между регионами с разным уровнем 
домашнего насилия (H = 11.8121; p = 0.0081), что свидетельствует о 
комплексной взаимосвязи социальных и демографических процессов.

Таким образом, применение комплекса непараметрических методов позволило 
выявить устойчивые статистические закономерности в демографических и 
социальных показателях регионов Испании, что подтверждает 
целесообразность использования таких критериев при анализе данных, не 
подчиняющихся нормальному распределению.

Код реализации всех критериев на языке Python доступен по ссылке: 
